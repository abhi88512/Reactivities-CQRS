# Section 9: MobX for Client-Side State Management

## Introduction to MobX

### Definition
MobX is a library for managing state in JavaScript applications, especially useful for React apps. It helps track and update data (called "state") on the client side (in the browser) without needing to reload the page.

### Purpose
MobX simplifies handling changes in app data, making it easier to build interactive features like counters or loading indicators. It's great for "client-side state" (data that's only in the browser, not from a server), but less ideal for server data compared to tools like React Query.

### Key Idea
MobX uses "observables" (trackable data) that automatically notify and update parts of your app when they change, reducing manual coding.

> **[Quote from Course]**: "Working with MobX is basically a continuous loop of me going, this is way too simple. It definitely won't work, only to be proven wrong." This highlights how MobX feels surprisingly easy but effective, like discovering a shortcut in a maze that actually works.

## Learning Goals
- Understand MobX basics: observables, actions, computed properties, reactions, and auto run.
- Learn to set up MobX in a React app and use it for simple state like counters.
- Compare MobX to Redux (more complex for reading) and React Query (better for server data).
- Apply MobX to track global UI elements, like loading indicators.

## Core Functionality of MobX

### Observables
- These are pieces of data (like variables) that MobX watches for changes.
- When an observable changes, any part of the app "observing" it (like a React component) automatically updates.
- Example: Declare a variable like `firstName` as observable, and components using it will re-render if it changes.

### Actions
- Functions that update observables safely.
- They ensure changes are tracked and trigger updates.
- Example: An action to set `firstName = 'New Name'`.

### Computed Properties
- Derived values based on observables (like calculating a full name from first and last name).
- They auto-update when source observables change.
- Useful for avoiding repeated calculations.

### Reactions and Auto Run
- Reactions: Run code (like logging) only after an observable changes.
- Auto Run: Similar to reactions but runs immediately on setup and then on changes.
- Analogy: Like setting an alarm (reaction) that only goes off when something specific happens, vs. one that checks right away (auto run).

## Setting Up MobX

### Installation
- Use npm to add MobX and its React integration.
- Code snippet (shell command):
  ```
  npm install mobx mobx-react-lite
  ```

### Creating a Store
- Stores are classes holding observables and actions.
- Use `makeObservable` or `makeAutoObservable` to set up tracking.
- Example (TypeScript):
  ```typescript
  import { makeAutoObservable } from 'mobx';

  export default class CounterStore {
    title = 'Counter Store';
    count = 0;

    constructor() {
      makeAutoObservable(this);
    }

    increment = (amount = 1) => {
      this.count += amount;
    };

    decrement = (amount = 1) => {
      this.count -= amount;
    };
  }
  ```

### Making Stores Global with React Context
- Create a context to share stores across the app.
- Example (TypeScript):
  ```typescript
  import { createContext } from 'react';
  import CounterStore from './CounterStore';

  export const store = {
    counterStore: new CounterStore()
  };

  export const StoreContext = createContext(store);
  ```
- Wrap your app in the provider (in `main.tsx`):
  ```tsx
  <StoreContext.Provider value={store}>
    {/* Rest of app */}
  </StoreContext.Provider>
  ```

### Custom Hook for Accessing Stores
- Create a hook to easily get stores in components.
- Example (TypeScript):
  ```typescript
  import { useContext } from 'react';
  import { StoreContext } from '../lib/stores/store';

  export function useStore() {
    return useContext(StoreContext);
  }
  ```

## Using MobX in Components

### Observing State
- Wrap components with `observer` to react to changes.
- Example (TypeScript, higher-order component style):
  ```tsx
  import { observer } from 'mobx-react-lite';
  import { useStore } from '../hooks/useStore';

  const Counter = observer(() => {
    const { counterStore } = useStore();
    return (
      <div>
        <h4>{counterStore.title}</h4>
        <h6>Count: {counterStore.count}</h6>
        <button onClick={() => counterStore.increment()}>Increment</button>
      </div>
    );
  });

  export default Counter;
  ```

### Adding Actions and Buttons
- Call actions from buttons to update state.
- Components auto-update due to observers.

### Computed Properties Example
- Add to store:
  ```typescript
  events: string[] = [`Initial count is ${this.count}`];

  get eventCount() {
    return this.events.length;
  }
  ```
- Update in actions (e.g., in increment: `this.events.push('Incremented...')`).
- Display in component: `{counterStore.eventCount}`.

## Applying MobX: Tracking Loading State

### UI Store for Global Loading
- Create a store for UI flags like loading.
- Example:
  ```typescript
  import { makeAutoObservable } from 'mobx';

  export default class UiStore {
    isLoading = false;

    constructor() {
      makeAutoObservable(this);
    }

    isBusy = () => { this.isLoading = true; };
    isIdle = () => { this.isLoading = false; };
  }
  ```

### Integrate with API Requests
- Use Axios interceptors to toggle loading.
- Example (in `agent.ts`):
  ```typescript
  import { store } from './stores/store';

  agent.interceptors.request.use(config => {
    store.uiStore.isBusy();
    return config;
  });

  agent.interceptors.response.use(response => response, error => {
    // Handle error
  }).finally(() => {
    store.uiStore.isIdle();
  });
  ```

### Display Loading Indicator
- In Navbar, show progress bar if loading.
- Example:
  ```tsx
  {uiStore.isLoading ? <LinearProgress color="secondary" style={{ position: 'absolute', bottom: 0, left: 0, right: 0, height: 4 }} /> : null}
  ```

## Key Commands Recap
- Install MobX: `npm install mobx mobx-react-lite`
- Create observable: Use `makeAutoObservable(this)` in constructor.
- Observe component: Wrap with `observer(Component)`.

## Tips for Beginners
- Start simple: Use MobX for browser-only data (e.g., UI toggles), not server data—pair it with React Query for that.
- Avoid common pitfalls: Always use arrow functions (`=>`) for actions in classes to bind them correctly; otherwise, "this" might not work as expected.
- Test changes: Refresh the page and click buttons to see auto-updates—it's like magic but based on observables!
- Compare tools: If your app has lots of server calls, React Query handles caching automatically; MobX shines for local state.

Next Steps: Practice by adding more stores (e.g., for user preferences) and integrate with React Router for routing without prop drilling. Explore reactions for side effects like logging.